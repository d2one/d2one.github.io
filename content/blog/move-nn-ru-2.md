+++
date = "2019-04-06T18:09:14-05:00"
draft = true
title = "Перенос проектов между ЦОДами. Часть 2"
slug = "move-projects-beetween-cod-part-2"
tags = [ "ЦОД","Миграции","Проект"]
type = ["posts","post"]
categories = [
    "Development"
]
+++
### С чего начать и что делать?
##### База данных Percona
Необходимо было получить реплику БД в нашем проде, откуда бы смогли перетащить данные в наш dev и встроить обновление данных в нашу ферму бд. БД в Нижнем Новгороде: 600GB данных, 15 Kq/s. Сервера в НН с бд страшно с ними что-то делать, так как он может не подняться. 
Чтобы получить реплику, мы подцепили наш сервер обычным слейвом, в обход Percona Exctradb. Почему так? Потому что для полноценной интеграции в кластер, необходимо было перезагрузить инстанс Percona. 
600 Gb данных переливались примерно 3 дня, так как канал между цодами НН и Урал у нас ограничен. 600Gb на zfs превратились в 400Gb. Далее, к этой реплике в ЕКБ мы подключили percona кластер в ЕКБ, и уже с него мы снимали zfs снэпшоты, для отправки в dev. Так у нас появилась БД в нашем дев окружении.
##### Sphinx
Когда у нас появились данные, то получить из него индексы для сфинкса не так уж сложно. У нас уже был собран пакет со sphinx необходимой версии. Поэтому все свелось к настройке параметров индексации данных их БД в поисковые индексы.
##### Openstack Swift
Самая тяжелая часть приложения. 20ТБ статики, которую необходимо перенести. 
Swift оперирует следующими понятиями: 
- object - наименьшая еденица информации - файл с картинкой и тд
- container - хранилище групп объектов. Напоминает папку с файлами
- ring - группа инстансов swift
Проблема в том, что расположение файлов на файлухе не соответсвует дискам. Пришлось запускать rsync и перекачивать все данные. Переливка заняла примерно 14 дней. 
Запустили swift, добавили новый инстанс в кольцо. Навешали повышенные приоритеты, на поднятый инстанс. Это значит, что новые данные будут складываться в новый свифт.
##### Memcached

##### PHP7 + laravel

##### PHP56

##### Nginx Cache для статики


##### Наиболее полезные инструменты
- ngrep






